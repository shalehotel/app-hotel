{"version":1,"resource":"file:///c%3A/app-hotel/components/cajas/turno-detail-sheet.tsx","entries":[{"id":"2Cnk.tsx","source":"Chat Edit: 'Esta es la arquitectura t√©cnica y el dise√±o l√≥gico para el m√≥dulo de Cajas (Historial y Sesi√≥n Activa), bas√°ndonos estrictamente en tu esquema de base de datos (caja_turnos y caja_movimientos).\r\n\r\n1. Historial de Cierres (/cajas/historial)\r\nEsta vista es la bit√°cora financiera. Aqu√≠ el Administrador audita si el dinero coincidi√≥ o si hubo p√©rdidas.\r\n\r\nA. Fuente de Datos (L√≥gica de Consulta)\r\nLa tabla principal es caja_turnos filtrando por estado = 'CERRADA'. Debes calcular el \"Estado del Cierre\" (Cuadrada/Descuadre) en el momento de la consulta o en el frontend, comparando las columnas:\r\n\r\nmonto_cierre_sistema (Lo que el software dice que debe haber).\r\n\r\nmonto_cierre_declarado (Lo que el recepcionista cont√≥ f√≠sicamente).\r\n\r\nB. Dise√±o de la Tabla (Columnas)\r\nFecha Cierre: fecha_cierre (Formato: dd/MM/yyyy HH:mm).\r\n\r\nCaja / Usuario: Nombre de la caja + Nombre del usuario responsable.\r\n\r\nApertura: monto_apertura (Muestra con qu√© empez√≥).\r\n\r\nCierre Sistema (Te√≥rico): monto_cierre_sistema.\r\n\r\nCierre Real (F√≠sico): monto_cierre_declarado.\r\n\r\nEstado (Badge Calculado):\r\n\r\nüü¢ CUADRADA: Si (Real - Sistema) == 0.\r\n\r\nüî¥ FALTANTE: Si (Real - Sistema) < 0. (Hubo p√©rdida).\r\n\r\nüîµ SOBRANTE: Si (Real - Sistema) > 0. (Sobra dinero, posible cobro no registrado).\r\n\r\nAcciones: Bot√≥n \"Ver Detalle\" (üëÅÔ∏è).\r\n\r\n2. Detalle de Turno (Sheet Lateral)\r\nAl hacer clic en \"Ver Detalle\", se abre un panel lateral. Este dise√±o sirve tanto para el Historial (Sesi√≥n cerrada) como para la Sesi√≥n Activa (Sesi√≥n abierta).\r\n\r\nA. Secci√≥n Superior: Resumen Financiero (KPIs)\r\nUsa los datos de la cabecera (caja_turnos).\r\n\r\nTarjeta 1: Saldo Inicial (monto_apertura).\r\n\r\nTarjeta 2: Flujo Neto (Ingresos - Egresos).\r\n\r\nNota: Esto se obtiene sumando los movimientos o usando la funci√≥n SQL calcular_movimientos_turno que ya tienes en tu schema.\r\n\r\nTarjeta 3: Total Esperado en Caja.\r\n\r\nTarjeta 4 (Solo si cerrada): Diferencia. Muestra cu√°nto falt√≥ o sobr√≥.\r\n\r\nB. Secci√≥n Inferior: Lista de Movimientos\r\nUna tabla filtrada por el ID del turno (caja_turno_id).\r\n\r\nColumnas: Hora | Tipo (Ingreso/Egreso) | Motivo | Monto | Usuario.\r\n\r\nEstilos: Pinta los Ingresos en verde y los Egresos en rojo para lectura r√°pida.\r\n\r\nContexto: Si el movimiento tiene comprobante_referencia, muestra un link o tooltip \"Ver Comprobante\".\r\n\r\n3. Sesi√≥n Activa (/cajas o /dashboard)\r\nEsta es la vista operativa del d√≠a a d√≠a.\r\n\r\nA. L√≥gica de Permisos\r\nRol RECEPCION:\r\n\r\nConsulta: SELECT * FROM caja_turnos WHERE estado = 'ABIERTA' AND usuario_id = [MI_ID].\r\n\r\nComportamiento: Si no hay resultado, muestra bot√≥n gigante \"Abrir Caja\". Si hay resultado, muestra el Widget de Caja Activa.\r\n\r\nRol ADMIN:\r\n\r\nConsulta: SELECT * FROM caja_turnos WHERE estado = 'ABIERTA'.\r\n\r\nComportamiento: Ve una grilla con todas las cajas abiertas de todos los recepcionistas.\r\n\r\nB. Widget de Caja Activa (El Panel de Control)\r\nMuestra en tiempo real c√≥mo va el turno actual.\r\n\r\nIndicador Vivo: \"üü¢ Turno Abierto hace 4 horas\".\r\n\r\nMonto Actual Te√≥rico: Monto Apertura + Total Ingresos - Total Egresos.\r\n\r\nImportante: Este n√∫mero es lo que el sistema \"cree\" que tienes.\r\n\r\nBotones de Acci√≥n R√°pida:\r\n\r\n[Registrar Ingreso/Egreso] (Movimiento manual, ej: compra de √∫tiles, propinas).\r\n\r\n[Arqueo R√°pido] (Opcional: contar billetes sin cerrar).\r\n\r\n[CERRAR TURNO] (Acci√≥n principal).\r\n\r\nC. Funcionalidad ADMIN: Cierre Forzoso\r\n¬øQu√© pasa si el recepcionista se fue a su casa y dej√≥ la caja abierta? El Admin debe poder cerrarla para que el turno de noche pueda abrir la suya.\r\n\r\nFlujo T√©cnico:\r\n\r\nAdmin ve la caja de \"Juan P√©rez\" abierta.\r\n\r\nClick en \"Cierre Forzoso\" (Un bot√≥n de peligro ‚ö†Ô∏è).\r\n\r\nEl sistema pregunta: \"¬øCu√°nto dinero hay f√≠sicamente en esa caja?\" (El admin debe ir a contar).\r\n\r\nAcci√≥n de Base de Datos:\r\n\r\nUPDATE caja_turnos\r\n\r\nSET estado = 'CERRADA'\r\n\r\nSET fecha_cierre = NOW()\r\n\r\nSET monto_cierre_declarado = [Lo que cont√≥ el Admin]\r\n\r\nSET monto_cierre_sistema = [C√°lculo autom√°tico]\r\n\r\n(Opcional) Agregar una nota en un campo de observaci√≥n si existiera, o usar el log de auditor√≠a.\r\n\r\nResumen de Implementaci√≥n T√©cnica\r\nBackend (Server Actions):\r\n\r\ngetCierresPasados(): Trae turnos cerrados con paginaci√≥n.\r\n\r\ngetTurnoActivo(userId?): Si eres admin, trae todos; si no, el tuyo.\r\n\r\ncerrarTurno(id, montoDeclarado): Ejecuta la l√≥gica de cierre, calcula el sistema, guarda y cambia estado.\r\n\r\nforzarCierreTurno(id, montoDeclarado): Igual al anterior pero con validaci√≥n de permisos de admin.\r\n\r\nFrontend:\r\n\r\nReutiliza el componente DetalleSheet (que te expliqu√© para facturaci√≥n) pero ad√°ptalo para mostrar datos de caja. Es la misma UX: Lista -> Click -> Panel Lateral.\r\n\r\nEsta estructura cubre todos los puntos: historial auditable, control en tiempo real y salvaguardas administrativas (cierre forzoso).'","timestamp":1767756678395},{"id":"Up1c.tsx","source":"Chat Edit: 'y por ejemplo supuestamente ya usamso solo shadcn, epro las de la app no son shadcn, veo colore raros, tipos d ebadges que no van con el dise√±o de shadcn, entoces de que sirve tenr intaldo y decir que usaremos shadcn si no se ve reflejado, por ejemplo veo badges verdes, y shadcn no usa badges verdes, y lo hace por que ntioende que no va con su dise√±o, en la pagina de shadcn en los diverson ejemplso y plantilla nuca verras ese color, shadcn usa lso colre que usa por que su propfesioales definieron que esos eran lso ams decuado y que iban con la estetica.\r\n\r\nen este ejemplo se ven las badges que usa shadcn:\r\nimport { AlertCircleIcon, BadgeCheckIcon, CheckIcon } from \"lucide-react\"\r\n\r\nimport { Badge } from \"@/components/ui/badge\"\r\n\r\nexport function BadgeDemo() {\r\n  return (\r\n    <div className=\"flex flex-col items-center gap-2\">\r\n      <div className=\"flex w-full flex-wrap gap-2\">\r\n        <Badge>Badge</Badge>\r\n        <Badge variant=\"secondary\">Secondary</Badge>\r\n        <Badge variant=\"destructive\">Destructive</Badge>\r\n        <Badge variant=\"outline\">Outline</Badge>\r\n      </div>\r\n      <div className=\"flex w-full flex-wrap gap-2\">\r\n        <Badge\r\n          variant=\"secondary\"\r\n          className=\"bg-blue-500 text-white dark:bg-blue-600\"\r\n        >\r\n          <BadgeCheckIcon />\r\n          Verified\r\n        </Badge>\r\n        <Badge className=\"h-5 min-w-5 rounded-full px-1 font-mono tabular-nums\">\r\n          8\r\n        </Badge>\r\n        <Badge\r\n          className=\"h-5 min-w-5 rounded-full px-1 font-mono tabular-nums\"\r\n          variant=\"destructive\"\r\n        >\r\n          99\r\n        </Badge>\r\n        <Badge\r\n          className=\"h-5 min-w-5 rounded-full px-1 font-mono tabular-nums\"\r\n          variant=\"outline\"\r\n        >\r\n          20+\r\n        </Badge>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\nno otras. y con esa podemos cubir culaqueir bage necesaria, por ejmplo:\r\n<Badge\r\n          variant=\"secondary\"\r\n          className=\"bg-blue-500 text-white dark:bg-blue-600\"\r\n        >\r\n          <BadgeCheckIcon />\r\n          Verified\r\n        </Badge>\r\n\r\nsrive para verificado, aceptado, correcto, ese seria el que en muchos casos usan verde.\r\n\r\ny los demas tmabien se peuden suar. es avriedd del ejemplo es los unico que necesitamos.\r\n\r\n\r\ntu tarea es buscar todas las badeges de la app, asegurar que usane el componete ofical, de shadcn, y el estilo correcto.'","timestamp":1767908103586},{"id":"TOa8.tsx","source":"Chat Edit: 'quiero que revices las shet de la app, y que el dise√±o sea minimalita moderno limpio, usamos shadcn y el estilo de shadcn nos encanta, ya de por si es minimlaista moderno y esteticamente limpio, nos gusta shadcn tal como es. '","timestamp":1767917609579},{"id":"5En4.tsx","source":"Chat Edit: 'quiero que revices las shet de la app, y que el dise√±o sea minimalita moderno limpio, usamos shadcn y el estilo de shadcn nos encanta, ya de por si es minimlaista moderno y esteticamente limpio, nos gusta shadcn tal como es. '","timestamp":1767917620631},{"id":"mdIp.tsx","timestamp":1768136801932}]}